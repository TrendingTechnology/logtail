<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script>
        const maxLines = 10000;
        let lineCount = 0;
        let ws;
        let output;

        function print(message) {
            let d = document.createElement("pre");
            d.innerText = message;
            output.appendChild(d);
            
            lineCount++
            if (lineCount > maxLines) {
                output.children.item(0).remove()
                lineCount--;
            }
        };

        function restartTail() {
            ws = null;
            if (window.confirm("connection closed, reconnect?")) {
                startTail();
            }
        }

        function startTail() {
            if (ws) {
                return false;
            }
            ws = new WebSocket("ws://" + document.location.host + "/tail");
            ws.onopen = function (evt) {
            }
            ws.onclose = function (evt) {
                restartTail();
            }
            ws.onmessage = function (evt) {
                print(evt.data);
            }
            ws.onerror = function (evt) {
                print("ERROR: " + evt.data);
                try {
                    ws.close()
                } catch (e) {
                }
                restartTail();
            }
        }

        window.addEventListener("load", function (evt) {
            output = document.getElementById("output");
            startTail()
        });
    </script>
</head>
<body>
<div id="output"></div>
</body>
</html>